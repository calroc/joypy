<h1 id="joypy">Joypy</h1>
<h2 id="a-dialect-of-joy-in-python.">A dialect of Joy in Python.</h2>
<p>Joy is a programming language created by Manfred von Thun that is easy to use and understand and has many other nice properties. This Python script is an interpreter for a dialect of Joy that attempts to stay very close to the spirit of Joy but does not precisely match the behaviour of the original version(s) written in C. A Tkinter GUI is provided as well.</p>
<table class="sourceCode python numberLines" startFrom="33"><tr class="sourceCode"><td class="lineNumbers"><pre>33
34
35
36
37
38
39
40
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="ch">from</span> <span class="dt">__future__</span> <span class="ch">import</span> print_function
<span class="kw">try</span>:
  <span class="dt">input</span> = <span class="dt">raw_input</span>
<span class="kw">except</span> <span class="ot">NameError</span>:
  <span class="kw">pass</span>
<span class="ch">from</span> traceback <span class="ch">import</span> print_exc
<span class="ch">from</span> .parser <span class="ch">import</span> text_to_expression
<span class="ch">from</span> .stack <span class="ch">import</span> strstack, iter_stack, list_to_stack</code></pre></td></tr></table>
<h2 id="print_trace">print_trace()</h2>
<p>Write out a string representation of the stack and expression to stdout.</p>
<table class="sourceCode python numberLines" startFrom="47"><tr class="sourceCode"><td class="lineNumbers"><pre>47
48
49
50
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="kw">def</span> print_trace(stack, expression):
  stack = <span class="dt">list</span>(iter_stack(stack))
  stack.reverse()
  <span class="kw">print</span>(strstack(list_to_stack(stack)), <span class="st">&#39;.&#39;</span>, strstack(expression))</code></pre></td></tr></table>
<h2 id="joy">ยง joy()</h2>
<p>The basic joy() function is quite straightforward. It iterates through a sequence of terms which are either literals (strings, numbers, sequences) or functions. Literals are put onto the stack and functions are executed.</p>
<p>Every Joy function is an unary mapping from stacks to stacks. Even literals are considered to be functions that accept a stack and return a new stack with the literal value on top.</p>
<table class="sourceCode python numberLines" startFrom="66"><tr class="sourceCode"><td class="lineNumbers"><pre>66
67
68
69
70
71
72
73
74
75
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="kw">def</span> joy(stack, expression, dictionary, viewer=print_trace):
  <span class="kw">while</span> expression:
    viewer(stack, expression)
    term, expression = expression
    <span class="kw">if</span> <span class="dt">callable</span>(term):
      stack, expression, dictionary = term(stack, expression, dictionary)
    <span class="kw">else</span>:
      stack = term, stack
  viewer(stack, expression)
  <span class="kw">return</span> stack, expression, dictionary</code></pre></td></tr></table>
<h2 id="run">run()</h2>
<p>Return the stack resulting from running the Joy code text on the stack.</p>
<table class="sourceCode python numberLines" startFrom="83"><tr class="sourceCode"><td class="lineNumbers"><pre>83
84
85
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="kw">def</span> run(text, stack, dictionary):
  expression = text_to_expression(text, dictionary)
  <span class="kw">return</span> joy(stack, expression, dictionary)</code></pre></td></tr></table>
<h2 id="repl">repl()</h2>
<h3 id="read-evaluate-print-loop">Read-Evaluate-Print Loop</h3>
<p>Accept input and run it on the stack, loop.</p>
<table class="sourceCode python numberLines" startFrom="95"><tr class="sourceCode"><td class="lineNumbers"><pre>95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="kw">def</span> repl(stack=(), dictionary=()):
  <span class="kw">try</span>:
    <span class="kw">while</span> <span class="ot">True</span>:
      <span class="kw">print</span>()
      <span class="kw">print</span>(<span class="st">&#39;-&gt;&#39;</span>, strstack(stack))
      <span class="kw">print</span>()
      <span class="kw">try</span>:
        text = <span class="dt">input</span>(<span class="st">&#39;joy? &#39;</span>)
      <span class="kw">except</span> (<span class="ot">EOFError</span>, <span class="ot">KeyboardInterrupt</span>):
        <span class="kw">break</span>
      <span class="kw">try</span>:
        stack, _, dictionary = run(text, stack, dictionary)
      <span class="kw">except</span>:
        print_exc()
  <span class="kw">except</span>:
    print_exc()
  <span class="kw">print</span>()
  <span class="kw">return</span> stack</code></pre></td></tr></table>
